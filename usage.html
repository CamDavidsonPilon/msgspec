
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Usage &#8212; msgspec 0+untagged.1.g313d185 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Extending" href="extending.html" />
    <link rel="prev" title="msgspec" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>For ease of use, <code class="docutils literal notranslate"><span class="pre">msgspec</span></code> exposes two functions <a class="reference internal" href="api.html#msgspec.encode" title="msgspec.encode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">encode</span></code></a> and <a class="reference internal" href="api.html#msgspec.decode" title="msgspec.decode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">decode</span></code></a>, for
serializing and deserializing objects respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">msgspec</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msgspec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">{&#39;hello&#39;: &#39;world&#39;}</span>
</pre></div>
</div>
<p>Note that if you’re making multiple calls to <a class="reference internal" href="api.html#msgspec.encode" title="msgspec.encode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">encode</span></code></a> or <a class="reference internal" href="api.html#msgspec.decode" title="msgspec.decode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">decode</span></code></a>, it’s more
efficient to create an <a class="reference internal" href="api.html#msgspec.Encoder" title="msgspec.Encoder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Encoder</span></code></a> and <a class="reference internal" href="api.html#msgspec.Decoder" title="msgspec.Decoder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decoder</span></code></a> once, and then use
<a class="reference internal" href="api.html#msgspec.Encoder.encode" title="msgspec.Encoder.encode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Encoder.encode</span></code></a> and <a class="reference internal" href="api.html#msgspec.Decoder.decode" title="msgspec.Decoder.decode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decoder.decode</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">enc</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">Encoder</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">{&#39;hello&#39;: &#39;world&#39;}</span>
</pre></div>
</div>
<section id="supported-types">
<span id="id1"></span><h2>Supported Types<a class="headerlink" href="#supported-types" title="Permalink to this headline">¶</a></h2>
<p>Msgspec currently supports serializing/deserializing the following types:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytearray</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">enum.Enum</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Ext" title="msgspec.Ext"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Ext</span></code></a></p></li>
</ul>
<p>Support for serializing additional types can be added through extensions, for
more information see <a class="reference internal" href="extending.html"><span class="doc">Extending</span></a></p>
</section>
<section id="typed-and-untyped-deserialization">
<span id="typed-deserialization"></span><h2>Typed and Untyped Deserialization<a class="headerlink" href="#typed-and-untyped-deserialization" title="Permalink to this headline">¶</a></h2>
<p>By default, both <a class="reference internal" href="api.html#msgspec.decode" title="msgspec.decode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">decode</span></code></a> and <a class="reference internal" href="api.html#msgspec.Decoder.decode" title="msgspec.Decoder.decode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decoder.decode</span></code></a> will deserialize messages
without any validation, performing <em>untyped deserialization</em>. <a class="reference external" href="https://github.com/msgpack/msgpack/blob/master/spec.md#formats">MessagePack
types</a> are
mapped to Python types as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nil</span></code>: <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code>: <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span></code>: <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float</span></code>: <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">str</span></code>: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bin</span></code>: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">array</span></code>: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></a> <a class="footnote-reference brackets" href="#tuple" id="id2">1</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">map</span></code>: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ext</span></code>: <a class="reference internal" href="api.html#msgspec.Ext" title="msgspec.Ext"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Ext</span></code></a> <a class="footnote-reference brackets" href="#extensions" id="id3">2</a> or <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> <a class="footnote-reference brackets" href="#datetime" id="id4">3</a></p></li>
</ul>
<dl class="footnote brackets">
<dt class="label" id="tuple"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Tuples are only used when the array type must be hashable (e.g.
keys in a <code class="docutils literal notranslate"><span class="pre">dict</span></code> or <code class="docutils literal notranslate"><span class="pre">set</span></code>). All other array types are deserialized as
lists by default.</p>
</dd>
<dt class="label" id="extensions"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>extension types can be mapped to/from custom types <em>even when
using untyped deserialization</em> through msgspec’s extension mechanism. For
more information see <a class="reference internal" href="extending.html"><span class="doc">Extending</span></a>.</p>
</dd>
<dt class="label" id="datetime"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>datetime objects are encoded/decoded using the <a class="reference external" href="https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type">timestamp
extension type</a>.
Note that on Windows this will only work for datetimes _after_ the <a class="reference external" href="https://en.wikipedia.org/wiki/Unix_time">Unix
epoch</a> (this is fixable with
some effort, if you need to support earlier timestamps on windows please
file an issue).</p>
</dd>
</dl>
<p>Messages composed of any combination of these will deserialize successfully
without any further validation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;three&quot;</span><span class="p">])</span>  <span class="c1"># encode a list with mixed types</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msgspec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># decodes using default types and no validation</span>
<span class="go">[1, &quot;two&quot;, b&quot;three&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># likewise for Decoder.decode</span>
<span class="go">[1, &quot;two&quot;, b&quot;three&quot;]</span>
</pre></div>
</div>
<p>If you want to deserialize a MessagePack type to a different Python type, or
perform any type checking you’ll need to specify a <em>deserialization type</em>. This
can be passed to either <a class="reference internal" href="api.html#msgspec.Decoder" title="msgspec.Decoder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decoder</span></code></a> (recommended) or <a class="reference internal" href="api.html#msgspec.decode" title="msgspec.decode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">decode</span></code></a>.</p>
<p>For example, say we wanted to deserialize the above as a <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of a
<code class="docutils literal notranslate"><span class="pre">list</span></code> (the default). We’d do this by specifying the expected message type as
a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># deserialize as a set</span>
<span class="go">{1, &quot;two&quot;, b&quot;three&quot;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msgspec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>  <span class="c1"># can also pass to msgspec.decode</span>
<span class="go">{1, &quot;two&quot;, b&quot;three&quot;}</span>
</pre></div>
</div>
<p>Nested type specifications are fully supported, and can be used to validate at
deserialization time. If a message doesn’t match the specified type, an
informative error message will be raised. For example, say we expect the above
message to be a set of ints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span>  <span class="c1"># define a decoder for a set of ints</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span>
<span class="go">Decoder(Set[int])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Invalid messages raise a nice error</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">msgspec.DecodingError</span>: <span class="n">Error decoding `Set[int]`: expected `int`, got `str`</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>  <span class="c1"># Valid messages deserialize properly</span>
<span class="go">{1, 2, 3}</span>
</pre></div>
</div>
<p>Typed deserializers are most commonly used along with <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Struct</span></code></a> messages to
provide a message schema, but any combination of the following types is
acceptible:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytes</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bytearray</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></a> / <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">typing.Tuple</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> / <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">typing.List</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> / <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">typing.Dict</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set</span></code></a> / <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Set" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">typing.Set</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">typing.Any</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">typing.Optional</span></code></a></p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Ext" title="msgspec.Ext"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Ext</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">enum.Enum</span></code></a> derived types</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a> derived types</p></li>
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">msgspec.Struct</span></code></a> derived types</p></li>
</ul>
<p>Custom types are also supported, provided a valid <code class="docutils literal notranslate"><span class="pre">ext_hook</span></code> or <code class="docutils literal notranslate"><span class="pre">dec_hook</span></code>
callback is defined on the Decoder. For more information, see <a class="reference internal" href="extending.html"><span class="doc">Extending</span></a>.</p>
</section>
<section id="structs">
<h2>Structs<a class="headerlink" href="#structs" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">msgspec</span></code> can serialize many builtin types, but unlike protocols like
<a class="reference external" href="https://docs.python.org/3/library/pickle.html">pickle</a>, it can’t serialize arbitrary user classes by default. Two
user-defined types are supported though:</p>
<ul class="simple">
<li><p><a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Struct</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">enum.Enum</span></code></a></p></li>
</ul>
<p>Structs are useful for defining structured messages. Fields are defined using
python type annotations. Default values can also be specified for any optional
arguments.</p>
<p>Here we define a struct representing a person, with two required fields and two
optional fields.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;A struct describing a person&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">first</span> <span class="p">:</span> <span class="nb">str</span>
<span class="gp">... </span>    <span class="n">last</span> <span class="p">:</span> <span class="nb">str</span>
<span class="gp">... </span>    <span class="n">address</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">phone</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Struct types automatically generate a few methods based on the provided type
annotations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__repr__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__copy__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__eq__</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">__ne__</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">harry</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Harry&quot;</span><span class="p">,</span> <span class="s2">&quot;Potter&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;4 Privet Drive&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">harry</span>
<span class="go">Person(first=&#39;Harry&#39;, last=&#39;Potter&#39;, address=&#39;4 Privet Drive&#39;, phone=None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">harry</span><span class="o">.</span><span class="n">first</span>
<span class="go">&quot;Harry&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ron</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Ron&quot;</span><span class="p">,</span> <span class="s2">&quot;Weasley&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;The Burrow&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ron</span> <span class="o">==</span> <span class="n">harry</span>
<span class="go">False</span>
</pre></div>
</div>
<p>If needed, a <code class="docutils literal notranslate"><span class="pre">__hash__</span></code> method can also be generated by specifying
<code class="docutils literal notranslate"><span class="pre">immutable=True</span></code> when defining the struct. Note that this disables modifying
field values after initialization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">,</span> <span class="n">immutable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;This struct is immutable &amp; hashable&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
<span class="gp">... </span>    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="c1"># immutable structs are hashable, and can be keys in dicts</span>
<span class="go">{Point(1.0, 2.0): 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># immutable structs cannot be modified after creation</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">TypeError</span>: <span class="n">immutable type: &#39;Point&#39;</span>
</pre></div>
</div>
<p>Note that it is forbidden to override <code class="docutils literal notranslate"><span class="pre">__init__</span></code>/<code class="docutils literal notranslate"><span class="pre">__new__</span></code> in a struct
definition, but other methods can be overridden or added as needed.</p>
<p>The struct fields are available via the <code class="docutils literal notranslate"><span class="pre">__struct_fields__</span></code> attribute (a
tuple of the fields in argument order ) if you need them. Here we add a method
for converting a struct to a dict.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;A point in 2D space&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="p">:</span> <span class="nb">float</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="p">:</span> <span class="nb">float</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__struct_fields__</span><span class="p">}</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&quot;x&quot;: 1.0, &quot;y&quot;: 2.0}</span>
</pre></div>
</div>
<p>Struct types are written in C and are quite speedy and lightweight. They’re
great for defining structured messages both for serialization and for use in an
application.</p>
<p>Like with builtin types, to deserialize a message as a struct you need to
provide the expected deserialization type to <a class="reference internal" href="api.html#msgspec.Decoder" title="msgspec.Decoder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Decoder</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>  <span class="c1"># Create a decoder that expects a Person</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span>
<span class="go">Decoder(Person)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">harry</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">Person(first=&#39;Harry&#39;, last=&#39;Potter&#39;, address=&#39;4 Privet Drive&#39;, phone=None)</span>
</pre></div>
</div>
<p>Using structs for message schemas not only adds validation during
deserialization, it also can improve performance. Depending on the schema,
deserializing a message into a <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Struct</span></code></a> can be <em>roughly twice as fast</em> as
deserializing it into a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>.</p>
<p>If you need higher performance (at the cost of more inscrutable message
encoding), you can set <code class="docutils literal notranslate"><span class="pre">asarray=True</span></code> on a struct definition. Structs with
this option enabled are encoded/decoded as MessagePack <code class="docutils literal notranslate"><span class="pre">array</span></code> types (rather
than <code class="docutils literal notranslate"><span class="pre">map</span></code> types), removing the field names from the serialized message. This
can provide another ~2x speedup for decoding (and ~1.5x speedup for encoding).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ArrayBasedStruct</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">,</span> <span class="n">asarray</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;This struct is serialized as a MessagePack array type</span>
<span class="gp">... </span><span class="sd">    (instead of a map type). This means no field names are sent</span>
<span class="gp">... </span><span class="sd">    as part of the message, speeding up encoding/decoding.&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">my_first_field</span><span class="p">:</span> <span class="nb">str</span>
<span class="gp">... </span>    <span class="n">my_second_field</span><span class="p">:</span> <span class="nb">int</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">ArrayBasedStruct</span><span class="p">(</span><span class="s2">&quot;some string&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">b&#39;\x92\xabsome string\x02&#39;</span>
</pre></div>
</div>
</section>
<section id="schema-evolution">
<span id="id5"></span><h2>Schema Evolution<a class="headerlink" href="#schema-evolution" title="Permalink to this headline">¶</a></h2>
<p>Msgspec includes support for “schema evolution”, meaning that:</p>
<ul class="simple">
<li><p>Messages serialized with an older version of a schema will be deserializable
using a newer version of the schema.</p></li>
<li><p>Messages serialized with a newer version of the schema will be deserializable
using an older version of the schema.</p></li>
</ul>
<p>This can be useful if, for example, you have clients and servers with
mismatched versions.</p>
<p>For schema evolution to work smoothly, you need to follow a few guidelines:</p>
<ol class="arabic simple">
<li><p>Any new fields on a <a class="reference internal" href="api.html#msgspec.Struct" title="msgspec.Struct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Struct</span></code></a> must specify default values.</p></li>
<li><p>Structs with <code class="docutils literal notranslate"><span class="pre">asarray=True</span></code> must not reorder fields, and any new fields
must be appended to the end (and have defaults).</p></li>
<li><p>Don’t change the type annotations for existing messages or fields.</p></li>
<li><p>Don’t change the type codes or implementations for any defined
<a class="reference internal" href="extending.html#extensions"><span class="std std-ref">Defining a custom extension</span></a>.</p></li>
</ol>
<p>For example, suppose we wanted to add a new <code class="docutils literal notranslate"><span class="pre">email</span></code> field to our <code class="docutils literal notranslate"><span class="pre">Person</span></code>
struct. To do so, we add it at the end of the definition, with a default value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person2</span><span class="p">(</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;A struct describing a person&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">first</span> <span class="p">:</span> <span class="nb">str</span>
<span class="gp">... </span>    <span class="n">last</span> <span class="p">:</span> <span class="nb">str</span>
<span class="gp">... </span>    <span class="n">address</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">phone</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>    <span class="n">email</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># added at the end, with a default</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vernon</span> <span class="o">=</span> <span class="n">Person2</span><span class="p">(</span><span class="s2">&quot;Vernon&quot;</span><span class="p">,</span> <span class="s2">&quot;Dursley&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;4 Privet Drive&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;vernon@grunnings.com&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Messages serialized using the new and old schemas can still be exchanged
without error. If an old message is deserialized using the new schema, the
missing fields all have default values that will be used. Likewise, if a new
message is deserialized with the old schema the unknown new fields will be
efficiently skipped without decoding.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">old_dec</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_dec</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">Person2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">new_msg</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">vernon</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">old_dec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">new_msg</span><span class="p">)</span>  <span class="c1"># deserializing a new msg with an older decoder</span>
<span class="go">Person(first=&quot;Vernon&quot;, last=&quot;Dursley&quot;, address=&quot;4 Privet Drive&quot;, phone=None)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">old_msg</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">harry</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_dec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">old_msg</span><span class="p">)</span> <span class="c1"># deserializing an old msg with a new decoder</span>
<span class="go">Person2(first=&#39;Harry&#39;, last=&#39;Potter&#39;, address=&#39;4 Privet Drive&#39;, phone=None, email=None)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">msgspec</a></h1>



<p class="blurb">A fast and friendly MessagePack library</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jcrist&repo=msgspec&type=watch&count=False&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#supported-types">Supported Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#typed-and-untyped-deserialization">Typed and Untyped Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#structs">Structs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schema-evolution">Schema Evolution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Docs</a></li>
</ul>

<h3>Need help?</h3>

<p>
  Open an issue in the <a href="https://github.com/jcrist/msgspec/issues">issue tracker</a>.
</p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Jim Crist-Harif.
      
      |
      <a href="_sources/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>